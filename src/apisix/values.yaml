#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

replicaCount: 1
image:
  repository: apache/apisix
  pullPolicy: IfNotPresent
  tag: "2.12.1-alpine"
  pullSecrets: []

version: v1

podAnnotations: {}

podSecurityContext:
  {}
  # fsGroup: 2000

securityContext:
  {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

gateway:
  # type: ClusterIP
  type: LoadBalancer
  # annotations:
  #   service.beta.kubernetes.io/aws-load-balancer-type: nlb
  http:
    enabled: true
    servicePort: 80
    containerPort: 9080
    #nodePort: 39080
  http2:
    enabled: true
    servicePort: 9083
    containerPort: 9083
    #nodePort: 39083
  tls:
    enabled: false
    servicePort: 443
    containerPort: 9443
     #nodePort: 39443
    http2:
      enabled: true

apisixConfig:
  apisix:
    enable_debug: true
  etcd:
    host:
      - http://etcd-headless:2379
    prefix: "/apisix"
    timeout: 30
    # user: root
    # password: password
    tls:
      verify: false
  nginx_config:
    error_log: /dev/stdout
    error_log_level: warn
    worker_processes: "1"
    http:
      access_log: /dev/stdout
  # wasm:                                                                                   
  #   plugins:                                                                              
  #     - name: http_wasm_filter                                                            
  #       priority: 7997                                                                    
  #       file: /tmp/http_wasm_filter.wasm

resources:
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  # cpu: 1000m
  # memory: 256Mi
  requests:
    cpu: 0m
    memory: 0Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

apisix-dashboard:
  enabled: true
  fullnameOverride: "apisix-dashboard"
  config:
    etcd:
      endpoints:
        - etcd-headless:2379
  apisixControl: "http://apisix-internal:9090"

apisix-ingress-controller:
  enabled: true
  nameOverride: ingress
  config:
    logLevel: "warn"
    enableProfiling: false
    kubernetes:
      appNamespaces: ["*"]
    apisix:
      serviceName: apisix-internal
      serviceNamespace: ingress-apisix
      servicePort: 9180
      adminKey: "edd1c9f034335f136f87ad84b625c8f1"

etcd:
  enabled: true
  replicaCount: 1
  fullnameOverride: "etcd"
  auth:
    rbac:
      enabled: false
      rootPassword: root
  persistence:
    size: 2Gi
  autoCompactionMode: periodic
  autoCompactionRetention: 10m
  metrics:
    enabled: true